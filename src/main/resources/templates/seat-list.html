<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>í‹°ì¼“ ì˜ˆë§¤ í˜„í™©íŒ</title>
    <style>
        .container { padding: 20px; }
        .seat-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; max-width: 600px; }
        .seat-card {
            border: 1px solid #ccc; padding: 15px; text-align: center; border-radius: 8px;
            background-color: #f9f9f9;
        }
        /* ìƒíƒœë³„ ìƒ‰ìƒ ì§€ì • */
        .status-AVAILABLE { background-color: #e0ffd4; border-color: #4caf50; } /* ì´ˆë¡ */
        .status-HELD { background-color: #fff4d4; border-color: #ff9800; }      /* ì£¼í™© */
        .status-CONFIRMED { background-color: #e0e0e0; border-color: #616161; color: #555; } /* íšŒìƒ‰ */
    </style>
</head>
<script>
    // ì˜ˆì•½ ìš”ì²­ (Hold)
    function holdSeat(seatId) {
        const command = { seatId: seatId, userId: 999 }; // í…ŒìŠ¤íŠ¸ìš© ìœ ì € ID

        fetch('/api/reservations', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(command)
        })
            .then(handleResponse);
    }

    // ì˜ˆì•½ í™•ì • (Confirm) - [ì‹ ê·œ ê¸°ëŠ¥]
    function confirmReservation(reservationId) {
        fetch(`/api/reservations/${reservationId}/confirm`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(handleResponse);
    }

    // ê³µí†µ ì‘ë‹µ ì²˜ë¦¬
    function handleResponse(response) {
        if (response.ok) {
            alert('ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.reload();
        } else {
            response.text().then(msg => alert('ì‹¤íŒ¨: ' + msg));
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const seats = document.querySelectorAll('.seat-card');

        seats.forEach(seat => {
            seat.addEventListener('click', function() {
                const seatId = this.dataset.id;
                // HTMLì— th:data-reservation-id ì†ì„±ì´ ì¶”ê°€ë˜ì–´ì•¼ í•¨ (ì•„ë˜ HTML ìˆ˜ì • ì°¸ê³ )
                const reservationId = this.dataset.reservationId;
                const status = this.querySelector('p').innerText;
                const seatNo = this.querySelector('h3').innerText;

                if (status === 'AVAILABLE') {
                    if (confirm(seatNo + ' ì¢Œì„ì„ ì˜ˆì•½(Hold) í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        holdSeat(seatId);
                    }
                } else if (status === 'HELD') {
                    // HELD ìƒíƒœë©´ í™•ì •í• ì§€ ë¬¼ì–´ë´„
                    if (confirm(seatNo + ' ì˜ˆì•½ì„ í™•ì •(Confirm) í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        confirmReservation(reservationId);
                    }
                } else {
                    alert('ì´ë¯¸ í™•ì •ëœ ì¢Œì„ì…ë‹ˆë‹¤.');
                }
            });
        });
    });
</script>
<body>
<div class="container">
    <h1>ğŸŸï¸ ì¢Œì„ ì˜ˆë§¤ í˜„í™©</h1>
    <div class="seat-grid">
        <div th:each="seat : ${seats}"
            class="seat-card"
            th:classappend="'status-' + ${seat.status}"
             th:attr="data-id=${seat.seatId}, data-reservation-id=${seat.reservationId}">

            <h3 th:text="${seat.seatCode}">A-1</h3>
            <p th:text="${seat.status}">AVAILABLE</p>

            <div th:if="${seat.reservationId != null}">
                <small th:text="'User: ' + ${seat.userId}">User: 1</small>
            </div>
        </div>
    </div>
</div>
</body>
</html>