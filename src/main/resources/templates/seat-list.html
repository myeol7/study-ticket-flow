<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>í‹°ì¼“ ì˜ˆë§¤ í˜„í™©íŒ</title>
    <style>
        .container { padding: 20px; }
        .seat-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; max-width: 600px; }
        .seat-card {
            border: 1px solid #ccc; padding: 15px; text-align: center; border-radius: 8px;
            background-color: #f9f9f9;
        }
        /* ìƒíƒœë³„ ìƒ‰ìƒ ì§€ì • */
        .status-AVAILABLE { background-color: #e0ffd4; border-color: #4caf50; } /* ì´ˆë¡ */
        .status-HELD { background-color: #fff4d4; border-color: #ff9800; }      /* ì£¼í™© */
        .status-CONFIRMED { background-color: #e0e0e0; border-color: #616161; color: #555; } /* íšŒìƒ‰ */
    </style>
</head>
<script>
    function holdSeat(seatId, userId) {
        // 1. ë³´ë‚¼ ë°ì´í„° ì¤€ë¹„ (Command ê°ì²´ ëª¨ì–‘ëŒ€ë¡œ JSON ìƒì„±)
        // DTOëŠ” ì„œë²„ê°€ ì£¼ëŠ” ê²ƒ, CommandëŠ” ìš°ë¦¬ê°€ ë³´ë‚´ëŠ” ê²ƒ!
        const command = {
            seatId: seatId,
            userId: userId
        };

        // 2. Fetch APIë¡œ ì„œë²„ì— POST ìš”ì²­ (eGovì˜ $.ajax ì™€ ë™ì¼)
        fetch('/api/reservations', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(command) // JS ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
        }).then(response => {
            if (response.ok) {
                alert('ì˜ˆì•½(Hold) ì„±ê³µ!');
                window.location.reload(); // í™”ë©´ ìƒˆë¡œê³ ì¹¨í•´ì„œ ìƒíƒœ ë°˜ì˜
            } else {
                // 400 Bad Request ë“±ì˜ ì—ëŸ¬ ì²˜ë¦¬
                return response.text().then(errorMessage => {
                    alert('ì‹¤íŒ¨: ' + errorMessage);
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
    }

    // ì¢Œì„ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    document.addEventListener('DOMContentLoaded', function() {
        const seats = document.querySelectorAll('.seat-card');

        seats.forEach(seat => {
            seat.addEventListener('click', function() {
                // ë°ì´í„° ì†ì„±ì´ë‚˜ í…ìŠ¤íŠ¸ì—ì„œ ID ì¶”ì¶œ (ì§€ê¸ˆì€ ì„ì‹œë¡œ í…ìŠ¤íŠ¸ íŒŒì‹±)
                // ì‹¤ì œë¡œëŠ” th:data-seat-id ì†ì„±ì„ ì“°ëŠ” ê²Œ ì •ì„ì…ë‹ˆë‹¤.

                // í¸ì˜ìƒ í™”ë©´ì˜ ìƒíƒœ í…ìŠ¤íŠ¸ë¥¼ ì½ì–´ì˜´
                const statusText = this.querySelector('p').innerText;
                const seatNo = this.querySelector('h3').innerText;

                // ì´ë¯¸ ì˜ˆì•½ëœ ì¢Œì„ì€ í´ë¦­ ë§‰ê¸°
                if (statusText !== 'AVAILABLE') {
                    alert('ì´ë¯¸ ì˜ˆì•½ëœ ì¢Œì„ì…ë‹ˆë‹¤.');
                    return;
                }

                if (confirm(seatNo + ' ì¢Œì„ì„ ì˜ˆì•½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    // ì¢Œì„ IDë¥¼ ì•Œê¸° ìœ„í•´ HTML íƒœê·¸ì— th:attr="data-id=${seat.seatId}" ì¶”ê°€ê°€ í•„ìš”í•¨
                    // ì¼ë‹¨ ì„ì‹œë¡œ seatIdë¥¼ í•˜ë“œì½”ë”©í•´ì„œ í…ŒìŠ¤íŠ¸í•˜ê±°ë‚˜,
                    // HTMLì„ ì¡°ê¸ˆ ìˆ˜ì •í•´ì•¼ í•¨. (ì•„ë˜ ê°€ì´ë“œ ì°¸ê³ )

                    // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì„ì˜ì˜ User ID 999 ì‚¬ìš©
                    const seatId = this.dataset.id;
                    holdSeat(seatId, 999);
                }
            });
        });
    });
</script>
<body>
<div class="container">
    <h1>ğŸŸï¸ ì¢Œì„ ì˜ˆë§¤ í˜„í™©</h1>
    <div class="seat-grid">
        <div th:each="seat : ${seats}"
            class="seat-card"
            th:classappend="'status-' + ${seat.status}"
            th:attr="data-id=${seat.seatId}">

            <h3 th:text="${seat.seatCode}">A-1</h3>
            <p th:text="${seat.status}">AVAILABLE</p>

            <div th:if="${seat.reservationId != null}">
                <small th:text="'User: ' + ${seat.userId}">User: 1</small>
            </div>
        </div>
    </div>
</div>
</body>
</html>